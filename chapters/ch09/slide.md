---
marp: true
author: neosarchizo
size: 4K
---

# Pixy2 고급 통신 방법

---

# 인터페이스

- 시리얼 통신
  - `SPI`
  - `I2C`
  - `UART`
- USB
- 아날로그/디지털

---

# 인터페이스별 특징 (USB)

- 리눅스 기반인 경우 `libpixyusb2` 라이브러리 사용
- 가장 속도가 빠름

---
# 인터페이스별 특징 (SPI)

- 아두이노의 경우 `SPI` 사용
- 2 MHz
- `I2C`, `UART`보다 빠름

---

# 인터페이스별 특징 (UART 또는 I2C)

- 19200 ~ 115200 bps
- `I2C`가 더 유연하게 사용 가능

---

# 인터페이스 설정하기

![](https://docs.pixycam.com/wiki/lib/exe/fetch.php?media=wiki:v1:image_743.png)

- 기어 아이콘 클릭
- **[Interface]** - **[Data out port]** 변경

---

# 인터페이스 설정하기

![](https://docs.pixycam.com/wiki/lib/exe/fetch.php?w=640&tok=f1a03d&media=wiki:v2:image_248_2.jpg)

---

# 인터페이스 설정하기 (Arduino ICSP SPI)

- 핀 3개 사용 : 1, 3, 4
- 아두이노 ICSP 커넥터로 통신 가능
- SPI의 SS(Slave Select)핀 사용 안함

---

# 인터페이스 설정하기 (SPI with SS)

- 핀 3개 사용 : 1, 3, 4, 7
- 7번 핀(SS) 사용
- 통신을 위해 SS핀을 제어해줘야함

---

# 인터페이스 설정하기 (I2C)

- 핀 2개 사용 : 5, 9
- 주소 설정 가능
  - 최대 127개
  - `I2C address`

---

# 인터페이스 설정하기 (UART)

- 핀 2개 사용 : 1, 4
- 보 레이트 설정 : `UART baudrate`
  
---

# 인터페이스 설정하기 (analog/digtal x)

- 핀 2개 사용 : 1(인식 여부), 8(전압)
- 전압 값 범위 : 0 ~ 3.3V
  
---

# 인터페이스 설정하기 (analog/digtal y)

- 핀 2개 사용 : 1(인식 여부), 8(전압)
- 전압 값 범위 : 0 ~ 3.3V
  
---

# 아날로그 입력

- 아날로그 출력핀 1개
- x 또는 y 택일
- x : 인식된 가장 큰 사물의 중심 x좌표
- y : 인식된 가장 큰 사물의 y좌표
- 1번 핀으로 인식 여부 확인
  - HIGH(3.3V) : 인식
  - LOW(0V) : 미인식

---
# 아날로그 입력

| 범위 | 0V   | 3.3V   |
|:----:|------|--------|
|   x  | 왼쪽 | 오른쪽 |
|   y  | 하단 | 상단   |

---

# 시리얼 프로토콜

- `SPI`, `I2C` 그리고 `UART` 모두 프로토콜은 동일

---

# 시리얼 프로토콜

- 요청

| 0 | 1 | 2 (타입) | 3 (데이터 길이) |
|---|---|---|---|
|0xAE|0xC1|??|0x00|

- 응답

| 0 | 1 | 2 (타입) | 3 (데이터 길이) | 4 (체크섬) | 5 (체크섬) | 6 데이터 |
|---|---|---|---|---|---|---|
|0xAF|0xC1|??|??|CS0|CS1|??|

- 체크섬 : 데이터 바이트들의 합
---

# 버젼 (요청)

```
0xae  
0xc1  
0x0e  // 버젼 요청 타입 (14)
0x00  // 데이터 길이 (0)
```

---

# 버젼 (응답)

```
0xaf 
0xc1 
0x0f // 버젼 응답 타입 (15)
0x10 // 데이터 길이 (16)
0x?? // 체크섬 첫번째 바이트
0x?? // 체크섬 두번째 바이트
0x?? // 하드웨어 버젼 첫번째 바이트
0x?? // 하드웨어 버젼 두번째 바이트
0x?? // 펌웨어 버젼 첫번째 바이트
0x?? // 펌웨어 버젼 두번째 바이트
0x?? // 펌웨어 빌드 번호 첫번째 바이트
0x?? // 펌웨어 빌드 번호 두번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 첫번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 두번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 세번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 네번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 다섯번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 여섯번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 일곱번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 여덟번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 아홉번째 바이트
0x?? // ASCII 형식의 펌웨어 정보 열번째 바이트
```

---

# 해상도 (요청)

```
0xae  
0xc1  
0x0C  // 해상도 요청 타입 (12)
0x01  // 데이터 길이 (1)
0x??  // 추후 버젼용 임시 자리
```

---

# 해상도 (응답)

```
0xaf 
0xc1 
0x0f // 버젼 응답 타입
0x0D // 데이터 길이 (13)
0x?? // 체크섬 첫번째 바이트
0x?? // 체크섬 두번째 바이트
0x?? // 프레임 너비 (0 ~ 511) 첫번째 바이트
0x?? // 프레임 너비 두번째 바이트
0x?? // 프레임 높이 (0 ~ 511) 첫번째 바이트
0x?? // 프레임 높이 두번째 바이트
```

---

# 카메라 밝기 설정 (요청)

```
0xae  
0xc1  
0x10  // 해상도 요청 타입 (16)
0x01  // 데이터 길이 (1)
0x??  // 카메라 밝기 (0 ~ 255)
```

---

# 카메라 밝기 설정 (응답)

```
0xaf 
0xc1 
0x01 // 버젼 응답 타입 (1)
0x04 // 데이터 길이 (4)
0x?? // 체크섬 첫번째 바이트
0x?? // 체크섬 두번째 바이트
0x?? // 결과값 첫번째 바이트
0x?? // 결과값 두번째 바이트
0x?? // 결과값 세번째 바이트
0x?? // 결과값 네번째 바이트
```

---

# 서보모터 제어 (요청)

```
0xae  
0xc1  
0x12  // 해상도 요청 타입 (18)
0x04  // 데이터 길이 (4)
0x??  // 팬 서보모터 각도 (0 ~ 511) 첫번째 바이트 
0x??  // 팬 서보모터 각도 두번째 바이트 
0x??  // 틸트 서보모터 각도 (0 ~ 511) 첫번째 바이트 
0x??  // 틸트 서보모터 각도 두번째 바이트 
```

---

# 서보모터 제어 (응답)

```
0xaf 
0xc1 
0x01 // 버젼 응답 타입 (1)
0x04 // 데이터 길이 (4)
0x?? // 체크섬 첫번째 바이트
0x?? // 체크섬 두번째 바이트
0x?? // 결과값 첫번째 바이트
0x?? // 결과값 두번째 바이트
0x?? // 결과값 세번째 바이트
0x?? // 결과값 네번째 바이트
```